"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[409],{92606:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Bt});var r=n(21902),o=n(87602),i=n(22770),a=n(97265),l=n.n(a);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==u(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===u(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p=(0,r.createContext)(void 0),d=function(e){var t=e.initialPath,n=void 0===t?"/":t,o=e.children,i=f((0,r.useState)(n),2),a=i[0],l=i[1],u=(0,r.useMemo)((function(){return{currentPath:a,navigate:l}}),[a]);return r.createElement(p.Provider,{value:u},o)},y=function(e){var t=e.path,n=e.children,o=(0,r.useContext)(p);if(!o)throw new Error("Route must be used within SimpleRouter");return o.currentPath===t?r.createElement(r.Fragment,null,n):null},v=function(){var e=(0,r.useContext)(p);if(!e)throw new Error("useNavigate must be used within SimpleRouter");return e.navigate},b=function(e){var t=e.path,n=e.style,o=e.children,i=(0,r.useContext)(p);if(!i)throw new Error("KeepAlive must be used within SimpleRouter");var a=i.currentPath===t,l=f((0,r.useState)(!1),2),u=l[0],c=l[1];return(0,r.useEffect)((function(){a&&c(!0)}),[a]),u?r.createElement("div",{style:s(s({},n),{},{display:a?"block":"none"})},o):null},g=n(80151),h=n(58938),E=n(54067),w=n(4022),O=n(36469),S=n(56733),C={Perception:{polygon:{defaultVisible:!0,currentVisible:!0,vizKey:"polygon"},boundingbox:{defaultVisible:!1,currentVisible:!1,vizKey:"boundingbox"},pointCloud:{defaultVisible:!1,currentVisible:!1,vizKey:"pointCloud"},unknownMovable:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownMovable"},vehicle:{defaultVisible:!0,currentVisible:!0,vizKey:"vehicle"},unknownStationary:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownUnmovable"},pedestrian:{defaultVisible:!0,currentVisible:!0,vizKey:"pedestrian"},unknown:{defaultVisible:!0,currentVisible:!0,vizKey:"unknown"},bicycle:{defaultVisible:!0,currentVisible:!0,vizKey:"bicycle"},cipv:{defaultVisible:!0,currentVisible:!0,vizKey:"cipv"},velocity:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleVelocity"},heading:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleHeading"},id:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleId"},distanceAndSpeed:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDistanceAndSpeed"},laneMarker:{defaultVisible:!1,currentVisible:!1,vizKey:"laneMarker"},lidarSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"lidarSensor"},radarSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"radarSensor"},cameraSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"cameraSensor"},v2x:{defaultVisible:!1,currentVisible:!1,vizKey:"v2x"}},Prediction:{priority:{defaultVisible:!0,currentVisible:!0,vizKey:"obstaclePriority"},majorPredictionLine:{defaultVisible:!0,currentVisible:!0,vizKey:"majorPredictionLine"},gaussianInfo:{defaultVisible:!1,currentVisible:!1,vizKey:"gaussianInfo"},minorPredictionLine:{defaultVisible:!0,currentVisible:!0,vizKey:"minorPredictionLine"},interactiveTag:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleInteractiveTag"}},Routing:{routingLine:{defaultVisible:!0,currentVisible:!0,vizKey:"routingLine"}},Decision:{mainDecision:{defaultVisible:!0,currentVisible:!0,vizKey:"mainDecision"},obstacleDecision:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDecision"}},Planning:{planningCar:{defaultVisible:!1,currentVisible:!1,vizKey:"planningCar"},planningTrajectoryLine:{defaultVisible:!0,currentVisible:!0,vizKey:"planningTrajectoryLine"},planningReferenceLine:{defaultVisible:!1,currentVisible:!1,vizKey:"PlanningReferenceLine"},planningBoundaryLine:{defaultVisible:!1,currentVisible:!1,vizKey:"PlanningBoundaryLine"}},Position:{localization:{defaultVisible:!0,currentVisible:!0,vizKey:"localization"},gps:{defaultVisible:!1,currentVisible:!1,vizKey:"gps"},shadow:{defaultVisible:!1,currentVisible:!1,vizKey:"shadow"}},Map:{crosswalk:{defaultVisible:!0,currentVisible:!0,vizKey:"crosswalk"},clearArea:{defaultVisible:!0,currentVisible:!0,vizKey:"clearArea"},junction:{defaultVisible:!1,currentVisible:!1,vizKey:"junction"},pncJunction:{defaultVisible:!1,currentVisible:!1,vizKey:"pncJunction"},lane:{defaultVisible:!0,currentVisible:!0,vizKey:"lane"},road:{defaultVisible:!1,currentVisible:!1,vizKey:"road"},signal:{defaultVisible:!0,currentVisible:!0,vizKey:"signal"},stopSign:{defaultVisible:!0,currentVisible:!0,vizKey:"stopSign"},yieldSign:{defaultVisible:!0,currentVisible:!0,vizKey:"yieldSign"},speedBump:{defaultVisible:!0,currentVisible:!0,vizKey:"speedBump"},parkingSpace:{defaultVisible:!0,currentVisible:!0,vizKey:"parkingSpace"},parkingSpaceId:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpaceId"},laneId:{defaultVisible:!1,currentVisible:!1,vizKey:"laneId"}}},P=function(e){var t={};return Object.keys(e).forEach((function(n){var r=e[n];Object.keys(r).forEach((function(e){var o=r[e];t[n]=t[n]||{},t[n][o.vizKey]=o.currentVisible}))})),t},x=new O.mM(O.SA.layerMenuParams),j=function(){return x.get()||C},R=n(52007),k=n(16125),N=n(27140);function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function T(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==A(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==A(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===A(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function V(e){var t,n,o=(0,S.Z)(),a=o.classes,l=o.cx,u=e.carviz,c=e.pointCloudFusionChannel,s=e.handlePointCloudVisible,f=e.pointcloudChannels,m=e.updatePointcloudChannel,p=e.curChannel,d=e.setCurChannel,y=e.handleReferenceLineVisible,v=e.handleBoundaryLineVisible,b=e.handleTrajectoryLineVisible,g=(0,E.$G)("layerMenu").t,w=(0,R.R)().panelId,A=(0,k.Z)().metadata,I=(0,r.useCallback)((function(e){if("pointCloud"===e){var t,n=null===(t=A.find((function(e){return e.dataName===h.DU.POINT_CLOUD})))||void 0===t?void 0:t.channels;if(Array.isArray(n)){var r=n.some((function(e){return e.channelName.includes("compensator")})),o=n.some((function(e){return e.channelName.includes("fusion")}));return!(r||o)}}return!1}),[A]),L=j();x.set(L),u.option.updateLayerOption(P(L),"vehicle");var V=M((0,r.useState)(L),2),D=V[0],z=V[1],_=M((0,r.useState)(Object.keys(D)),1)[0],K=M((0,r.useState)(_[0]),2),U=K[0],W=K[1],B=M((0,r.useState)(D[U]),2),G=B[0],H=B[1],Z=(0,r.useRef)(),$=(0,O._)("".concat(w,"-viz-pointcloud-channel")),Y=(0,r.useMemo)((function(){var e=(D[U].pointCloud||{}).currentVisible;return Z.current=e,r.createElement("li",{className:a["layer-menu-content-right-li"],key:"pointCloud"},r.createElement("span",{className:a["layer-menu-content-right-switch"]},r.createElement(i.XZ,{checked:e,defaultChecked:e,onChange:function(e){var t=e.target.checked;Z.current=t;var n=F(F({},D[U]),{},{pointCloud:F(F({},D[U].pointCloud),{},{currentVisible:t})}),r=F(F({},D),{},T({},U,n));H((function(){return n})),z((function(){return r})),u.option.updateLayerOption(P(r),"vehicle"),x.set(r),t&&s&&s(e.target.checked),t||s&&s(e.target.checked)}})),r.createElement("span",{className:a["layer-menu-content-right-label"]},g("pointCloud")))}),[u.option,I,a,U,s,D,c,g]);return r.createElement("div",{className:a["layer-menu-container"]},r.createElement("div",{className:a["layer-menu-header"]},r.createElement("div",{className:a["layer-menu-header-left"]},g("layerMenu")),r.createElement("div",{className:a["layer-menu-header-right"]},r.createElement("div",{className:a["layer-menu-header-reset-btn"],onClick:function(){z((function(){return C})),u.option.updateLayerOption(P(C),"vehicle"),x.set(C)}},g("restoreDefaultSettings")))),r.createElement("div",{className:a["layer-menu-content"]},r.createElement("div",{className:a["layer-menu-content-left"]},_.map((function(e){return r.createElement("li",{key:e,className:l(a["layer-menu-content-left-li"],T({},a["li-active"],U===e)),onClick:function(){W(e),H(D[e])}},r.createElement("span",null,g(e)))}))),r.createElement("div",{className:a["layer-menu-content-right"]},"Perception"===U&&r.createElement(r.Fragment,null,r.createElement("li",{className:a["layer-menu-content-right-li"]},r.createElement("span",{className:a["layer-menu-content-right-switch"]},r.createElement(i.Y8,{checked:null==D||null===(t=D.Perception)||void 0===t||null===(t=t.polygon)||void 0===t?void 0:t.currentVisible,onChange:function(e){if(e.target.checked){var t=F(F({},D.Perception),{},{polygon:F(F({},D.Perception.polygon),{},{currentVisible:!0}),boundingbox:F(F({},D.Perception.boundingbox),{},{currentVisible:!1})}),n=F(F({},D),{},T({},U,t));H((function(){return t})),z((function(){return n})),u.option.updateLayerOption(P(n),"vehicle"),x.set(n)}}})),r.createElement("span",{className:a["layer-menu-content-right-label"]},g("polygon"))),r.createElement("li",{className:a["layer-menu-content-right-li"]},r.createElement("span",{className:a["layer-menu-content-right-switch"]},r.createElement(i.Y8,{checked:null==D||null===(n=D.Perception)||void 0===n||null===(n=n.boundingbox)||void 0===n?void 0:n.currentVisible,onChange:function(e){if(e.target.checked){var t=F(F({},D.Perception),{},{polygon:F(F({},D.Perception.polygon),{},{currentVisible:!1}),boundingbox:F(F({},D.Perception.boundingbox),{},{currentVisible:!0})}),n=F(F({},D),{},T({},U,t));H((function(){return t})),z((function(){return n})),u.option.updateLayerOption(P(n),"vehicle"),x.set(n)}}})),r.createElement("span",{className:a["layer-menu-content-right-label"]},g("boundingbox"))),r.createElement("div",{className:a["layer-menu-horizontal-line"]})),Y,r.createElement(N.Z,{disabled:!Z.current,value:p,options:f,onChange:function(e){return function(e){d(e),m(e),$.set(e)}(e)}}),r.createElement("div",{className:a["layer-menu-horizontal-line"]}),Object.keys(G).map((function(e){if("pointCloud"===e)return null;var t=(D[U][e]||{}).currentVisible;return"polygon"!==e&&"boundingbox"!==e&&r.createElement("li",{className:a["layer-menu-content-right-li"],key:e},r.createElement("span",{className:a["layer-menu-content-right-switch"]},r.createElement(i.XZ,{checked:t,disabled:I(e),defaultChecked:t,onChange:function(t){var n=t.target.checked,r=F(F({},D[U]),{},T({},e,F(F({},D[U][e]),{},{currentVisible:n}))),o=F(F({},D),{},T({},U,r));H((function(){return r})),z((function(){return o})),u.option.updateLayerOption(P(o),"vehicle"),x.set(o),n&&"pointCloud"===e&&!I(e)&&c&&s&&s(t.target.checked),n||"pointCloud"!==e||s&&s(t.target.checked),"planningReferenceLine"===e&&y(n),"planningBoundaryLine"===e&&v(n),"planningTrajectoryLine"===e&&b(n)}})),r.createElement("span",{className:a["layer-menu-content-right-label"]},g(e)))})))))}const D=r.memo(V);var z=n(79424),_=n(51999),K=n(4492),U=n(10108),W=n(44606);function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==B(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==B(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===B(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Z(){return(0,W.BH)((function(e){return{"routing-editing-op-area":H({width:192,height:32,color:"#A6B5CC",borderRadius:6,position:"absolute",top:24,left:24},e.util.flex("row","space-between","center")),"routing-editing-btn":H(H({width:144,height:32,borderRadius:6,background:"#343C4D"},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:"#38465A",color:"#fff"}}),"routing-editing-btn__icon":{marginRight:6},"routing-editing-btn__text":{fontFamily:"PingFangSC-Regular",fontSize:14},"common-routing-editing-btn":H(H({width:32,minWidth:32,height:32,minHeight:32,background:"#343C4D",borderRadius:6},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:"#38465A",color:"#fff"}}),"common-routing-editing-btn__icon":{},"routing-editing-disable":{cursor:"not-allowed","& .routing-editing-btn-disable":{color:"#515761",pointerEvents:"none",background:"#383D47"},"& .common-routing-editing-btn-disbale":{color:"#515761",pointerEvents:"none",background:"#383D47"}},"routing-editing-btn-popover":{"& .dreamview-popover-inner-content":{padding:"5px 10px",fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400",borderRadius:"6px"},"& .dreamview-popover-arrow::after":{}},"common-routing-popover-ordinary":{"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"}},"common-routing-popover-functional":{"& .dreamview-popover-inner,& .dreamview-popover-arrow::before, & .dreamview-popover-arrow::after":{color:"#A6B5CC !important",background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"}}}}))()}var $=(0,r.forwardRef)((function(e,t){var n=e.onClick,o=Z(),a=o.classes,l=o.cx,u=(0,E.$G)("routeEditing").t;return r.createElement("div",{id:"routing-editing-btn",className:l(a["routing-editing-btn"],"routing-editing-btn-disable"),onClick:n,ref:t},r.createElement("i",{className:a["routing-editing-btn__icon"]},r.createElement(i.xI,null)),r.createElement("div",{className:a["routing-editing-btn__text"]},u("routingEditing")))})),Y=(0,r.forwardRef)((function(e,t){var n=e.onClick,o=Z(),a=o.classes,l=o.cx;return r.createElement("div",{className:l(a["common-routing-editing-btn"],"common-routing-editing-btn-disbale"),onClick:n,ref:t},r.createElement("i",{className:a["common-routing-editing-btn__icon"]},r.createElement(i.xG,null)))}));$.displayName="RoutingEditingBtn",Y.displayName="CommonRoutingEditingBtn";var J=n(26658),q=n(6837),X=n(61534),Q=n(86944),ee=n(64698);function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==te(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==te(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===te(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||ie(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){if(e){if("string"==typeof e)return ae(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ae(e,t):void 0}}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function le(e){var t,n=e.EE,o=e.destroy,a=e.mainApi,l=e.panelContext,u=e.routeManager,c=e.routingEditor,s=e.isMainConnected,f=e.defaultRoutingList,m=e.createCommonRoutingSuccessFunctional,p=oe(i.l0.useForm(),1)[0],d=(0,W.BH)((function(e){return{"routing-modal":{"& .dreamview-modal-wrap":{zIndex:"1040"},"& .dreamview-modal-mask":{zIndex:"1040"},"& .dreamview-modal-content":{width:"492px","& .dreamview-modal-body":{marginTop:"30px",label:{color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontWeight:"400"},"& .dreamview-form":{"& .ant-form-item":{marginBottom:"16px"},"& > div:nth-of-type(1)":{"& .ant-form-item-label":{"& label":{position:"relative",top:"4px"}}}}}},"& .dreamview-modal-footer":{display:"flex",justifyContent:"center",alignItems:"center","& > button":{width:"74px",height:"40px",borderRadius:"8px"},"& > button:nth-of-type(1)":{color:"#FFFFFF",background:"#282B36",border:"1px solid rgba(124,136,153,1)"},"& > button:nth-of-type(2)":{background:"#3288FA",borderRadius:"8px",marginLeft:"24px !important"}}},"routing-form-initial":{fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400",color:"#FFFFFF",marginLeft:"39px",marginBottom:"16px",display:"flex"},"routing-form-initial-content":{width:"320px",color:"#FFFFFF",display:"flex",justifyContent:"space-between"},"routing-form-initial-content-heading":{width:"111px"},"routing-form-way":{height:"264px",border:"1px solid rgba(56,59,69,1)",borderRadius:"8px",padding:"16px 0px 16px 45px",marginBottom:"12px"},"routing-form-way-con":{fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400",color:"#FFFFFF",display:"flex"},"routing-form-way-content":{flex:"1"},"routing-form-way-item":{color:"#FFFFFF",marginBottom:"8px",display:"flex",justifyContent:"space-between"},"routing-form-way-item-heading":{width:"111px"},"routing-form-colon":{color:"#A6B5CC",marginRight:"6px"},"routing-form-colon-distance":{marginLeft:"2px"},"routing-form-loop-disable":{background:"rgb(40, 93, 164)","& .dreamview-switch-handle":{background:"rgb(190, 206, 227)",borderRadius:"3px"}},"create-modal-form":{"& .ant-form-item-label":{"& label":{color:"#A6B5CC !important"}}}}}))(),y=(d.cx,d.classes),v=(0,E.$G)("routeEditing").t,b=u.currentRouteMix,g=b.getCurrentRouteMix().currentRouteLoop.currentRouteLoopState,w=null===(t=b.getCurrentRouteMix().currentRouteLoop)||void 0===t?void 0:t.currentRouteLoopTimes,O=oe((0,r.useState)([]),2),S=O[0],C=O[1],P=oe((0,r.useState)({x:0,y:0}),2),x=P[0],j=P[1];return(0,r.useEffect)((function(){var e=c.initiationMarker.initiationMarkerPosition,t=c.pathwayMarker.pathWatMarkerPosition;e?j(e):a.getStartPoint().then((function(e){j({x:e.x,y:e.y,heading:null==e?void 0:e.heading})})),C(t)}),[s]),r.createElement(i.u_,{title:v("routeCreateCommonBtn"),okText:v("create"),cancelText:v("cancel"),open:!0,onOk:function(){p.validateFields().then((function(){if(s&&a){var e=p.getFieldsValue();if(e.loopRouting){var t=Number(e.cycleNumber);e.cycleNumber=t>10?10:t}delete e.loopRouting,a.saveDefaultRouting(re(re({},e),{},{routingType:h.Sw.DEFAULT_ROUTING,point:[x].concat((r=S,function(e){if(Array.isArray(e))return ae(e)}(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||ie(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))})).then((function(){n.emit(ee.l.SimControlRoute,{panelId:l.panelId,routeInfo:{initialPoint:x,wayPoint:S,cycleNumber:null==e?void 0:e.cycleNumber}}),m(),o(),(0,i.yw)({type:"success",content:v("createCommonRouteSuccess")})}))}var r}))},onCancel:function(){o()},rootClassName:y["routing-modal"]},r.createElement(i.l0,{form:p,name:"form",className:y["create-modal-form"],initialValues:{loopRouting:g,cycleNumber:w}},r.createElement(i.l0.Item,{label:v("name"),style:{marginLeft:"74px"},name:"name",rules:[function(e){return e.getFieldValue,{validator:function(e,t){return t?t&&f.find((function(e){return e.name===t}))?Promise.reject(new Error(v("alreadyExists"))):Promise.resolve():Promise.reject(new Error(v("pleaseEnter")))}}}]},r.createElement(i.II,{placeholder:"Please enter",style:{width:"252px",height:"40px"}})),r.createElement("div",{className:y["routing-form-initial"]},r.createElement("div",{className:y["routing-form-colon"]},v("initialPoint"),r.createElement("span",{className:y["routing-form-colon-distance"]},":")),r.createElement("div",{className:y["routing-form-initial-content"]},r.createElement("div",null,"[".concat(x.x.toFixed(3)," ，").concat(x.y.toFixed(3),"]")),r.createElement("div",{className:y["routing-form-initial-content-heading"]},null!=x&&x.heading?x.heading.toFixed(3):"-"))),r.createElement(Q.Z,{className:y["routing-form-way"]},r.createElement("div",{className:y["routing-form-way-con"]},r.createElement("div",{className:y["routing-form-colon"]},v("wayPoint"),r.createElement("span",{className:y["routing-form-colon-distance"]},":")),r.createElement("div",{className:y["routing-form-way-content"]},null==S?void 0:S.map((function(e,t){return r.createElement("div",{key:"".concat(e.x).concat(e.y).concat(t+1),className:y["routing-form-way-item"]},r.createElement("div",null,"[".concat(e.x.toFixed(3),"，").concat(e.y.toFixed(3),"]")),r.createElement("div",{className:y["routing-form-way-item-heading"]},null!=e&&e.heading?e.heading.toFixed(3):"-"))}))))),g&&r.createElement(i.l0.Item,{label:v("loopRouting"),style:{marginLeft:"16px"},name:"loopRouting",valuePropName:"checked"},r.createElement(i.rs,{disabled:!0,className:y["routing-form-loop-disable"]})),g&&r.createElement(i.l0.Item,{label:v("setLooptimes"),style:{marginLeft:"11px"},name:"cycleNumber",rules:[function(e){return e.getFieldValue,{validator:function(e,t){return t?Number(t)>10?Promise.reject(new Error("Max loop times is 10")):Promise.resolve():Promise.reject(new Error("Please enter"))}}}]},r.createElement(i.Rn,{type:"number",max:10,precision:0,disabled:!0}))))}var ue=function(e){return e.EDITING_ROUTE="editing",e.CREATING_ROUTE="creating",e}({}),ce=function(e){return e.INITIAL_POINT="initial_point",e.WAY_POINT="way_point",e}({}),se=n(53457),fe=n(7501),me="INIT_ROUTING_EDITOR",pe="INIT_ROUTE_MANAGER",de=se.Fk.createStoreProvider({initialState:{routingEditor:null,routeManager:null},reducer:function(e,t){return(0,fe.Uy)(e,(function(e){switch(t.type){case me:e.routingEditor=t.payload.routingEditor;break;case pe:e.routeManager=t.payload.routeManager}}))}}),ye=de.StoreProvider,ve=de.useStore,be=n(63483),ge=n(32870);function he(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||Ee(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ee(e,t){if(e){if("string"==typeof e)return we(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?we(e,t):void 0}}function we(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Oe(e){var t=e.activeOrigin,n=e.destroyFunFavoriteNotFullScreen,o=(0,W.BH)((function(e){return{"favorite-scroll":{width:"284px",maxHeight:"402px",padding:"16px 16px"},"favorite-creating-op":{width:"252px",height:"40px",marginBottom:"10px"},"favorite-common-co":{"& > div:last-child":{borderBottom:"none"}},"favorite-common-item":{height:"40px",color:"#A6B5CC",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular",borderBottom:"1px solid #383B45",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center","& .favorite-common-item-op-hover":{display:"none"},"&:hover":{width:"268px",background:"rgba(115,193,250,0.08)",borderRadius:"6px",margin:"0px -8px 0px -8px",padding:"0px 8px 0px 8px","& .favorite-common-item-op-no-hover":{display:"none"},"& .favorite-common-item-op-hover":{display:"block"}}},"favorite-common-item-active":{background:"#3288FA !important",borderRadius:"6px",margin:"0px -8px 0px -8px",padding:"0px 8px 0px 8px","& .favorite-common-item-name-cx":{color:"#FFFFFF"},"& .favorite-common-item-op-no-hover-val-cx":{background:"#3288FA"},"& .favorite-common-item-op-no-hover-title-cx":{color:"#FFFFFF !important"},"&: hover":{"& .favorite-common-item-op-hover":{display:"none"},"& .favorite-common-item-op-no-hover":{display:"block"}}},"favorite-common-item-op-no-hover-title":{color:"#808B9D"},"favorite-common-item-op-no-hover-val":{width:"18px",height:"18px",color:"#FFFFFF",fontSize:"12px",textAlign:"center",lineHeight:"18px",marginLeft:"4px",background:"#343C4D",borderRadius:"4px",display:"inline-block"},"favorite-common-item-op-hover-remove":{color:"#FFFFFF",marginLeft:"23px"},"favorite-common-item-name":{width:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},"favorite-warning-co":{padding:"14px 0px 32px 0px",display:"flex",flexDirection:"column",alignItems:"center"},"favorite-warning-co-desc":{width:"195px",color:"#A6B5CC",fontSize:"12px",fontWeight:"400",fontFamily:"PingFangSC-Regular"},"favorite-warning-co-desc-active":{color:"#3288FA",cursor:"pointer"}}}))(),a=o.cx,l=o.classes,u=(0,ge.x2)(),c=v(),s=(0,R.R)(),f=s.enterFullScreen,m=(0,E.$G)("routeEditing").t,p=he(ve(),1)[0],d=p.routeManager,y=p.routingEditor,b=d.currentRouteManager,g=(0,k.Z)(),h=g.mainApi,w=g.isMainConnected,O=he((0,r.useState)(null),2),S=O[0],C=O[1],P=he((0,r.useState)([]),2),x=P[0],j=P[1],N=function(){w&&h.getDefaultRoutings().then((function(e){j(e.defaultRoutings.reverse())}))},A=(0,r.useCallback)((function(){t===be.yP.FROM_FULLSCREEN&&(y.pathwayMarker.positionsCount&&w?(0,X.Z)({EE:u,mainApi:h,routeManager:d,routingEditor:y,panelContext:s,isMainConnected:w,defaultRoutingList:x,createCommonRoutingSuccessFunctional:N},le):(0,i.yw)({type:"error",content:m("NoWayPointMessage")})),t===be.yP.FROM_NOT_FULLSCREEN&&(n(),c("/routing"),f())}),[u,h,x,d,y,s,t,d,w,c,f]);return(0,r.useEffect)((function(){w&&h.getDefaultRoutings().then((function(e){j(e.defaultRoutings.reverse())}))}),[w]),(0,r.useEffect)((function(){var e,t,n,r,o,i;C((e=x,t=b.getCurrentRoute(),o=[null==t||null===(n=t.routePoint)||void 0===n?void 0:n.routeInitialPoint].concat(function(e){if(Array.isArray(e))return we(e)}(i=(null==t||null===(r=t.routePoint)||void 0===r?void 0:r.routeWayPoint)||[])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(i)||Ee(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),e.find((function(e){return e.point.length===o.length&&e.point.every((function(e,t){var n,r,i;return(null==e?void 0:e.heading)===(null===(n=o[t])||void 0===n?void 0:n.heading)&&e.x===(null===(r=o[t])||void 0===r?void 0:r.x)&&e.y===(null===(i=o[t])||void 0===i?void 0:i.y)}))}))))}),[x]),(0,r.useEffect)((function(){t!==be.yP.FROM_NOT_FULLSCREEN&&w&&h.getStartPoint().then((function(e){var t={x:e.x,y:e.y,heading:null==e?void 0:e.heading},n=y.pathwayMarker.lastPosition;h.checkCycleRouting({start:t,end:n}).then((function(e){e.isCycle||d.currentRouteMix.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}})}))}))}),[w,t]),r.createElement(Q.Z,{className:l["favorite-scroll"]},t!==be.yP.FROM_NOT_FULLSCREEN&&r.createElement(i.zx,{className:l["favorite-creating-op"],onClick:A},m("routeCreateCommonBtn")),x.length?r.createElement("div",{className:l["favorite-common-co"]},x.map((function(e){return r.createElement("div",{key:e.name,onClick:function(){return function(e){C(e);var t=s.panelId,n=e.point[0],r=e.point.slice(1),o=null==e?void 0:e.cycleNumber,i={initialPoint:n,wayPoint:r,cycleNumber:o};d.currentRouteMix.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!!o,currentRouteLoopTimes:o}}),h.setStartPoint({point:n}).then((function(){b.setCurrentRoute({routeOrigin:ue.CREATING_ROUTE,routePoint:{routeInitialPoint:n,routeWayPoint:r}}),u.emit(ee.l.SimControlRoute,{panelId:t,routeInfo:i})}))}(e)},className:a(l["favorite-common-item"],S&&S.name===e.name&&l["favorite-common-item-active"])},r.createElement("div",{className:a("favorite-common-item-name-cx",l["favorite-common-item-name"]),title:e.name},e.name),e.cycleNumber&&r.createElement("div",{className:a("favorite-common-item-op-no-hover")},r.createElement("span",{className:a("favorite-common-item-op-no-hover-title-cx",l["favorite-common-item-op-no-hover-title"])},m("looptimes")),r.createElement("span",{className:a("favorite-common-item-op-no-hover-val-cx",l["favorite-common-item-op-no-hover-val"])},e.cycleNumber)),r.createElement("div",{className:a("favorite-common-item-op-hover")},r.createElement("span",{onClick:(t=e.name,function(e){e.stopPropagation(),w&&h.deleteDefaultRouting(t).then((function(){h.getDefaultRoutings().then((function(e){j(e.defaultRoutings.reverse())}))}))}),className:a("favorite-common-item-op-hover-remove-cx",l["favorite-common-item-op-hover-remove"])},r.createElement(q.Z,null))));var t}))):r.createElement("div",{className:l["favorite-warning-co"]},r.createElement("img",{src:J,alt:"resource_empty"}),r.createElement("div",{className:l["favorite-warning-co-desc"]},"".concat(m("createRouteToolTip"),","),r.createElement("span",{className:l["favorite-warning-co-desc-active"],onClick:A},m("goToCreate")))))}const Se=r.memo(Oe);function Ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xe(){var e=Z(),t=e.classes,n=e.cx,o=v(),a=Ce((0,g.Mq)(),1)[0],l=(0,R.R)().enterFullScreen,u=(0,E.$G)("routeEditing").t,c={popoverDisableText:u("routeEditingBtnOther")},s=Ce((0,r.useState)(!1),2),f=s[0],m=s[1],p=Ce((0,r.useState)(!1),2),d=p[0],y=p[1],b=Ce((0,r.useState)(!0),2),h=b[0],w=b[1],O=r.createElement(Se,{activeOrigin:be.yP.FROM_NOT_FULLSCREEN,destroyFunFavoriteNotFullScreen:function(){y(!1)}}),S=(0,r.useCallback)((function(){l(),setTimeout((function(){o("/routing")})),(0,U.Ok)({dv_viz_func_name:"Route Editing"})}),[l,o]);return(0,r.useEffect)((function(){a.currentOperation===g.yc.PLAY_RECORDER||a.currentOperation===g.yc.SCENARIO||a.currentOperation===g.yc.SIM_CONTROL||a.currentOperation===g.yc.AUTO_DRIVE?w(!1):w(!0)}),[a]),r.createElement("div",{className:n(h&&t["routing-editing-disable"],t["routing-editing-op-area"])},h?r.createElement(r.Fragment,null,r.createElement(i.J2,{content:null==c?void 0:c.popoverDisableText,trigger:"hover",placement:"top",rootClassName:t["routing-editing-btn-popover"]},r.createElement(r.Fragment,null,r.createElement($,{onClick:S}))),r.createElement(i.J2,{content:null==c?void 0:c.popoverDisableText,trigger:"hover",placement:"top",rootClassName:t["routing-editing-btn-popover"]},r.createElement(r.Fragment,null,r.createElement(Y,null)))):r.createElement(r.Fragment,null,r.createElement($,{onClick:S}),r.createElement(i.J2,{content:u("routeCreateCommonBtn"),trigger:"hover",placement:"top",open:f,onOpenChange:function(e){m(e),y(!1)},rootClassName:t["routing-editing-btn-popover"]},r.createElement(i.J2,{content:O,trigger:"click",placement:"rightTop",open:d,onOpenChange:function(e){m(!1),y(e),(0,U.Ok)({dv_viz_func_name:"Common Routing"})},destroyTooltipOnHide:!0},r.createElement(r.Fragment,null,r.createElement(Y,null))))))}var je=n(84663),Re=n(24545),ke=function(e){return e.DEFAULT="Default",e.OVERHEAD="Overhead",e.MAP="Map",e.NEAR="Near",e.TOP_DOWN="TopDown",e}({}),Ne=function(e){return e.DEFAULT="Default",e.FOLLOW="Follow",e}({});function Ae(e){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ae(e)}function Ie(){return Ie=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ie.apply(this,arguments)}function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==Ae(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Ae(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ae(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Me(e){var t=(0,W.BH)((function(e){return{"custom-popover":{"&.dreamview-popover .dreamview-popover-inner":{padding:0},"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8)"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8)"},"& .dreamview-popover-content .dreamview-popover-inner .dreamview-popover-inner-content":Te({},e.tokens.typography.content)}}}))(),n=t.classes;return t.cx,r.createElement(i.J2,Ie({},e,{rootClassName:"".concat(n["custom-popover"]," ").concat(e.rootClassName||"")}))}const Le=r.memo(Me);function Ve(e){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==Ve(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Ve(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ve(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _e(e){return(0,W.BH)((function(e,t){return{"routing-editing-function-area":ze({width:32,position:"absolute",top:25,left:24},e.util.flex("column","space-around","center")),"routing-editing-function-area__group":{background:"#343C4D",borderRadius:6,marginBottom:10},"routing-editing-functional__item":ze(ze({width:32,minWidth:32,height:32,minHeight:32,background:"#343C4D",borderRadius:6},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:"#38465A"}}),"hover-color-change":{"&:hover":{color:"#fff"}},"routing-editing-functional__item--active":{color:"#3388FA"},"routing-editing-functional__icon":{},"custom-popover-ordinary":{"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"}},"custom-popover-functinal":{"& .dreamview-popover-inner,& .dreamview-popover-arrow::before, & .dreamview-popover-arrow::after":{color:"#A6B5CC !important",background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"}},"routing-editing-functional__item--disable":{cursor:"not-allowed","&:hover":{cursor:"not-allowed"}}}}))(e)}function Ke(e){return Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ke(e)}function Ue(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==Ke(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Ke(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ke(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function We(e,t){var n,o=e.functionalName,a=e.checkedItem,l=e.onClick,u=e.disable,c=(0,r.useMemo)((function(){return a===o}),[o,a]),s=_e({}),f=s.classes,m=s.cx,p=(0,r.useMemo)((function(){switch(o){case be.Iz.RELOCATE:return r.createElement("i",null,r.createElement(i.Xf,null));case be.Iz.WAYPOINT:return r.createElement("i",null,r.createElement(i.vC,null));case be.Iz.LOOP:return r.createElement("i",null,r.createElement(i.Fc,null));case be.Iz.FAVORITE:return r.createElement("i",null,r.createElement(i.xG,null));default:return null}}),[o]);return r.createElement("div",{ref:t,className:m(f["routing-editing-functional__item"],(n={},Ue(n,f["routing-editing-functional__item--active"],c),Ue(n,f["hover-color-change"],!c),Ue(n,f["routing-editing-functional__item--disable"],u),n)),onClick:l},r.createElement("div",{className:f["routing-editing-functional__icon"]},p))}const Be=(0,r.forwardRef)(We);var Ge=function(e){return e.FunctionalRelocateNoActive="initialPoint",e.FunctionalRelocateNoActiveDis="Inial Point is only available for simulation",e.FunctionaWayNoActive="wayPoint",e.FunctionalLoopNoActive="loopRouting",e.FunctionalFavoriteNoActive="commonRouting",e}({});function He(e){var t=e.functionalItemNoActiveText,n=(0,W.BH)((function(e){return{"routing-editing-item-no-active":{padding:"5px 10px",color:"#FFFFFF",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular"}}}))(),o=n.classes,i=(n.cx,(0,E.$G)("routeEditing").t);return r.createElement("div",{className:o["routing-editing-item-no-active"]},i(t))}function Ze(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return $e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$e(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ye(e){var t=(0,W.BH)((function(e){return{"functional-initial-con":{display:"flex"},"functional-initial-every-icon-con":{cursor:"not-allowed"},"functional-initial-disable":{"& .functional-initial-every-icon-disable":{color:"#40454D",pointerEvents:"none"}},"functional-initial-popover":{"& .dreamview-popover-inner-content":{padding:"5px 10px",color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400"}},"functional-initial-every-icon":{width:"32px",height:"32px",color:"#A6B5CC",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#D8D8D8",background:"rgba(115,193,250,0.08)"}}}}))(),n=t.classes,o=t.cx,a=Ze(ve(),1)[0].routingEditor,l=(0,E.$G)("routeEditing").t,u=(0,k.Z)(),c=u.isMainConnected,s=u.mainApi,f=Ze((0,r.useState)(a.initiationMarker.positionsCount),2),m=f[0],p=f[1],d=Ze((0,r.useState)(!(m>0)),2),y=d[0],v=d[1];return(0,r.useEffect)((function(){v(!m)}),[m]),r.createElement("div",{className:o(y&&n["functional-initial-disable"],n["functional-initial-con"])},r.createElement(i.J2,{content:l("backToLastPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},r.createElement("div",{className:y&&o(n["functional-initial-every-icon-con"])},r.createElement("div",{className:o("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){var e=a.initiationMarker.undo();c&&(e?s.setStartPoint({point:e}).then((function(){p(a.initiationMarker.positionsCount)})):s.setResetPoint().then((function(){p(a.initiationMarker.positionsCount)})))}},r.createElement(i.jd,null)))),r.createElement(i.J2,{content:l("backToStartPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},r.createElement("div",{className:y&&o(n["functional-initial-every-icon-con"])},r.createElement("div",{className:o("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){c&&s.setResetPoint().then((function(){a.initiationMarker.reset(),p(a.initiationMarker.positionsCount)}))}},r.createElement(i.Nq,null)))))}function Je(e){return Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Je(e)}function qe(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==Je(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Je(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Je(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Qe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function et(e){var t=(0,W.BH)((function(e){return{"functional-initial-con":{display:"flex"},"functional-initial-every-icon-con":{cursor:"not-allowed"},"functional-initial-disable":{"& .functional-initial-every-icon-disable":{color:"#40454D",pointerEvents:"none"}},"functional-initial-popover":{"& .dreamview-popover-inner-content":{padding:"5px 10px",color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400"}},"functional-initial-every-icon":{width:"32px",height:"32px",color:"#A6B5CC",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#D8D8D8",background:"rgba(115,193,250,0.08)"}}}}))(),n=t.classes,o=t.cx,a=Xe(ve(),1)[0].routingEditor,l=(0,E.$G)("routeEditing").t,u=Xe((0,r.useState)(a.pathwayMarker.positionsCount),2),c=u[0],s=u[1],f=Xe((0,r.useState)(!(c>0)),2),m=f[0],p=f[1];return(0,r.useEffect)((function(){p(!c)}),[c]),r.createElement("div",{className:o(qe({},n["functional-initial-disable"],m),n["functional-initial-con"])},r.createElement(i.J2,{content:l("removeLastPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},r.createElement("div",{className:o(qe({},n["functional-initial-every-icon-con"],m))},r.createElement("div",{className:o("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){a.pathwayMarker.undo(),s(a.pathwayMarker.positionsCount)}},r.createElement(i.jd,null)))),r.createElement(i.J2,{content:l("removeAllPoints"),trigger:"hover",rootClassName:n["functional-initial-popover"]},r.createElement("div",{className:o(qe({},n["functional-initial-every-icon-con"],m))},r.createElement("div",{className:o("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){a.pathwayMarker.reset(),s(a.pathwayMarker.positionsCount)}},r.createElement(i.hO,null)))))}function tt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rt(e){var t=(0,W.BH)((function(e){return{"functional-loop-con":{width:"257px",padding:"16px 0px 21px 0px",color:"#A6B5CC",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular"},"functional-loop-switch":{width:"160px",height:"20px",margin:"0px 0px 0px 32px",display:"flex",justifyContent:"space-around",alignItems:"center"},"functional-loop-switch-help":{"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-inner-content":{width:"302px",color:"#FFFFFF",fontSize:"14px",fontWeight:"400",padding:"5px 10px",borderRadius:"6px",fontFamily:"PingFangSC-Regular",background:"rgba(80, 88, 102, 0.8)"}},"functional-loop-switch-remind":{position:"relative",top:"2px"},"functional-loop-input":{height:"32px",margin:"16px 0px 0px 20px",display:"flex",alignItems:"center"},"functional-loop-input-text":{marginRight:"6px"}}}))(),n=t.classes,o=(t.cx,tt(ve(),1)[0].routeManager),a=(0,E.$G)("routeEditing").t,l=o.currentRouteMix,u=l.getCurrentRouteMix(),c=tt((0,r.useState)(u.currentRouteLoop.currentRouteLoopState),2),s=c[0],f=c[1];return r.createElement("div",{className:n["functional-loop-con"]},r.createElement("div",{className:n["functional-loop-switch"]},r.createElement("div",null,"".concat(a("loopRouting"),":")),r.createElement("div",null,r.createElement(i.rs,{onChange:function(e){e?l.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!0,currentRouteLoopTimes:1}}):l.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}}),f(e)},checked:s})),r.createElement(i.J2,{content:a("loopRoutingHelp"),trigger:"hover",placement:"top",rootClassName:n["functional-loop-switch-help"]},r.createElement("div",{className:n["functional-loop-switch-remind"]},r.createElement(i.Ki,null)))),s&&r.createElement("div",{className:n["functional-loop-input"]},r.createElement("div",{className:n["functional-loop-input-text"]},"".concat(a("setLooptimes"),":")),r.createElement("div",null,r.createElement(i.Rn,{min:1,max:10,precision:0,onChange:function(e){l.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!0,currentRouteLoopTimes:e}})},defaultValue:l.getCurrentRouteMix().currentRouteLoop.currentRouteLoopTimes}))))}function ot(e){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ot(e)}function it(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?it(Object(n),!0).forEach((function(t){lt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function lt(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==ot(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==ot(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===ot(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ut(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ct(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ct(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function st(e){var t=e.carviz,n=e.changeActiveName,o=e.activeName,a=ut((0,g.Mq)(),2),l=a[0],u=(a[1],ut(ve(),1)[0]),c=u.routeManager,s=u.routingEditor,f=(0,k.Z)(),m=f.isMainConnected,p=f.mainApi,d=(0,E.$G)("routeEditing").t,y=c.currentRouteMix,v=ut((0,r.useState)(null),2),b=v[0],h=v[1],w=l.currentOperation===g.yc.AUTO_DRIVE,O=_e({relocateDisState:w}),S=O.classes,C=O.cx,P=(0,r.useCallback)((function(e,n){var r={routeOrigin:ue.EDITING_ROUTE,routePoint:{routeInitialPoint:t.initiationMarker.initiationMarkerPosition,routeWayPoint:t.pathwayMarker.pathWatMarkerPosition}};if(n)if("lastPosition"in n){var o,i,a=n.lastPosition;"edit"===e&&(null===(i=c.currentRouteManager)||void 0===i||i.setScribeCurrentCheckPoint(at(at({},a),{},{type:ce.WAY_POINT}))),null===(o=c.currentRouteManager)||void 0===o||o.setCurrentRoute(r)}else{var l,u;"edit"===e&&(null===(u=c.currentRouteManager)||void 0===u||u.setScribeCurrentCheckPoint(at(at({},n),{},{type:ce.INITIAL_POINT}))),null===(l=c.currentRouteManager)||void 0===l||l.setCurrentRoute(r)}}),[t.initiationMarker,t.pathwayMarker,c.currentRouteManager]);(0,r.useEffect)((function(){Object.values(be.c3).includes(o)&&([be.c3.RELOCATE,be.c3.WAYPOINT].includes(o)||h(null))}),[o,t]),(0,r.useEffect)((function(){var e=function(e){"r"===e.key&&b!==be.Iz.RELOCATE&&(null==t||t.deactiveAll(),h(be.Iz.RELOCATE),null==n||n(be.c3.RELOCATE),null==t||t.initiationMarker.active(P)),"w"===e.key&&b!==be.Iz.WAYPOINT&&(null==t||t.deactiveAll(),h(be.Iz.WAYPOINT),null==n||n(be.c3.WAYPOINT),null==t||t.pathwayMarker.active(P)),(e.ctrlKey||e.metaKey)&&"z"===e.key&&(b===be.Iz.RELOCATE&&(null==t||t.initiationMarker.undo()),b===be.Iz.WAYPOINT&&(null==t||t.pathwayMarker.undo()))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[b]);var x=(0,r.useCallback)((function(e){return function(){if(e!==be.Iz.RELOCATE||!w){if(b===e)return Object.values(be.c3).includes(e)&&(null==t||t.deactiveAll()),void h(null);switch(e){case be.Iz.RELOCATE:h(e),null==t||t.deactiveAll(),null==n||n(be.c3.RELOCATE),null==t||t.initiationMarker.active(P);break;case be.Iz.WAYPOINT:h(e),null==t||t.deactiveAll(),null==n||n(be.c3.WAYPOINT),null==t||t.pathwayMarker.active(P);break;case be.Iz.LOOP:s.pathwayMarker.positionsCount>0?m&&p.getStartPoint().then((function(n){var r={x:n.x,y:n.y,heading:null==n?void 0:n.heading},o=s.pathwayMarker.lastPosition;p.checkCycleRouting({start:r,end:o}).then((function(n){n.isCycle?(h(e),null==t||t.deactiveAll()):(y.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}}),(0,i.yw)({type:"error",content:d("NoLoopMessage")}))}))})):(0,i.yw)({type:"error",content:d("NoWayPointMessage")});break;case be.Iz.FAVORITE:h(e),null==t||t.deactiveAll()}}}}),[t,n,b]),j=b===be.Iz.RELOCATE?r.createElement(Ye,null):r.createElement(He,{functionalItemNoActiveText:w?Ge.FunctionalRelocateNoActiveDis:Ge.FunctionalRelocateNoActive}),R=b===be.Iz.WAYPOINT?r.createElement(et,null):r.createElement(He,{functionalItemNoActiveText:Ge.FunctionaWayNoActive}),N=b===be.Iz.LOOP?r.createElement(rt,null):r.createElement(He,{functionalItemNoActiveText:Ge.FunctionalLoopNoActive}),A=b===be.Iz.FAVORITE?r.createElement(Se,{activeOrigin:be.yP.FROM_FULLSCREEN}):r.createElement(He,{functionalItemNoActiveText:Ge.FunctionalFavoriteNoActive});return r.createElement("div",{className:S["routing-editing-function-area"]},r.createElement("div",{className:S["routing-editing-function-area__group"]},r.createElement(Le,{content:j,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(b===be.Iz.RELOCATE?S["custom-popover-functinal"]:S["custom-popover-ordinary"])},r.createElement("div",{className:C(lt({},S["func-relocate-ele"],w))},r.createElement(Be,{functionalName:be.Iz.RELOCATE,checkedItem:b,onClick:x(be.Iz.RELOCATE),disable:w}))),r.createElement(Le,{content:R,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(b===be.Iz.WAYPOINT?S["custom-popover-functinal"]:S["custom-popover-ordinary"])},r.createElement("div",null,r.createElement(Be,{functionalName:be.Iz.WAYPOINT,checkedItem:b,onClick:x(be.Iz.WAYPOINT)}))),r.createElement(Le,{content:N,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(b===be.Iz.LOOP?S["custom-popover-functinal"]:S["custom-popover-ordinary"])},r.createElement("div",null,r.createElement(Be,{functionalName:be.Iz.LOOP,checkedItem:b,onClick:x(be.Iz.LOOP)})))),r.createElement(Le,{content:A,trigger:"hover",placement:"rightTop",destroyTooltipOnHide:!0,rootClassName:C(b===be.Iz.FAVORITE?S["custom-popover-functinal"]:S["custom-popover-ordinary"])},r.createElement("div",null,r.createElement(Be,{functionalName:be.Iz.FAVORITE,checkedItem:b,onClick:x(be.Iz.FAVORITE)}))))}const ft=r.memo(st);var mt=function(e){return{type:me,payload:e}},pt=function(e){return{type:pe,payload:e}};function dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function yt(){var e,t,n=(0,ge.x2)(),o=v(),a=(0,W.BH)((function(e){return{"routing-editing-op-con":{"& > button:nth-of-type(1)":{width:"72px",height:"32px",marginRight:"16px",backgroundColor:"transparent",border:"1px solid rgba(124,136,153,1)","&:hover":{color:"#3288FA",backgroundColor:"transparent",border:"1px solid #3288FA"},"&:active":{color:"#1252C0",backgroundColor:"#1252C0",border:"1px solid #1252C0"}},"& > button:nth-of-type(2)":{width:"114px",height:"32px"}}}}))(),l=a.classes,u=(a.cx,(0,R.R)()),c=(0,k.Z)().mainApi,s=(e=ve(),t=1,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return dt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],f=s.routingEditor,m=s.routeManager,p=(0,E.$G)("routeEditing").t;return r.createElement("div",{className:l["routing-editing-op-con"]},r.createElement(i.zx,{onClick:function(){i.u_.confirm({content:p("cancelEditingRouting"),icon:r.createElement("span",null),onOk:function(){o("/"),u.exitFullScreen()},okText:p("modalConfirmYes"),cancelText:p("modalConfirmNo")})}},p("cancel")),r.createElement(i.zx,{onClick:function(){var e,t=u.panelId,r=f.initiationMarker.initiationMarkerPosition,i={initialPoint:r,wayPoint:f.pathwayMarker.pathWatMarkerPosition,cycleNumber:null===(e=m.currentRouteMix.getCurrentRouteMix().currentRouteLoop)||void 0===e?void 0:e.currentRouteLoopTimes};r||c.getStartPoint().then((function(e){i.initialPoint=e})),m.currentRouteMix.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}}),n.emit(ee.l.SimControlRoute,{panelId:t,routeInfo:i}),o("/"),u.exitFullScreen()}},p("saveEditing")))}function vt(e){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vt(e)}function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==vt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==vt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===vt(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ht(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Et(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wt(){var e=(0,E.$G)("routeEditing").t,t=ht(ve(),2),n=t[0].routeManager,a=t[1],u=n.currentRouteManager,c=(0,R.R)().registerFullScreenHooks,s=(0,k.Z)(),f=s.mainApi,m=s.isMainConnected,p=ht((0,r.useState)(l().generate),1)[0],d=ht((0,r.useState)((function(){return new o.n(p)})),1)[0],y=ht((0,r.useState)((function(){return new je.Z})),1)[0],b=ht((0,r.useState)(null),2),h=b[0],w=b[1],O=function(e){h!==e&&w(e)},C=(0,S.Z)().classes,P=ht((0,g.Mq)(),1)[0],x=v();(0,r.useEffect)((function(){c({afterExitFullScreen:function(){x("/")}})}),[]),(0,r.useEffect)((function(){d.init(),d.view.changeViewType(ke.MAP,!1),a(mt({routingEditor:d}))}),[]);var j=(0,r.useCallback)((function(e){var t,n;null==f||f.getMapElementIds({point:{x:null!==(t=e.x)&&void 0!==t?t:0,y:null!==(n=e.y)&&void 0!==n?n:0},radius:400}).then((function(e){if(!je.Z.isMapElementIdsEmpty(e)){var t=ht(y.getMapElement(e),2),n=(t[0],t[1]);f.getMapElementsByIds(n).then((function(e){y.updateMapElement(e),null==d||d.updateMap(y.getAllMapElements()),d.render()}))}}))}),[m]);return(0,r.useEffect)((function(){var e;return d.removeAll(),d.deactiveAll(),y.clear(),null==f||f.getMapElementIds({radius:200}).then((function(t){var r=ht(y.getMapElement(t),2),o=(r[0],r[1]);f.getMapElementsByIds(o).then((function(t){if(y.updateMapElement(t),je.Z.findFirstMapElement(o))try{null==d||d.updateMap(t),d.render(),d.setCameraUpdateCallback(j),null==f||f.getStartPoint().then((function(t){d.coordinates.initialize(t.x,t.y),d.initiationMarker.init(t),j(new Re.Vector3(t.x,t.y,0)),e=n.currentRouteManager.subScribeCurrentRoute((function(e){var t=e.routeOrigin,n=e.routePoint;if(t===ue.CREATING_ROUTE){var r=n.routeInitialPoint,o=n.routeWayPoint;d.initiationMarker.init(r),d.pathwayMarker.init(o)}}))}))}catch(e){console.error("getMapElementById error",e)}}))})),function(){var t;null===(t=e)||void 0===t||t.unsubscribe()}}),[m,P.currentMap]),(0,r.useEffect)((function(){var t=u.subScribeCurrentCheckPoint((function(t){if(m){var n=t,r=t.type;delete n.type,f.checkRoutingPoint({point:gt(gt({},n),{},{id:0})}).then((function(t){t.isLegal?r===ce.INITIAL_POINT&&f.setStartPoint({point:gt({},n)}):(r===ce.INITIAL_POINT&&(d.initiationMarker.undo(),(0,i.yw)({type:"error",content:e("checkStartPointTooltip")})),r===ce.WAY_POINT&&(d.pathwayMarker.undo(),(0,i.yw)({type:"error",content:e("checkPointTooltip")})))}))}}));return function(){t.unsubscribe()}}),[m]),r.createElement("div",{className:C["viz-container"]},r.createElement("div",{id:p,className:C["web-gl"]}),r.createElement(ft,{carviz:d,activeName:h,changeActiveName:O}),r.createElement("div",{className:C["view-btn-container"]},r.createElement(_.Z,{from:"RoutingEditing",carviz:d,activeName:h,changeActiveName:O})),r.createElement("div",{className:C["view-ope-container"]},r.createElement(yt,null)))}var Ot=n(41857),St=n(17063);function Ct(e){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ct(e)}function Pt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Ct(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Ct(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Ct(o)?o:String(o)),r)}var o}var xt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteSubject=new Ot.X(t),this.currentCheckPointSubject=new St.x}var t,n;return t=e,(n=[{key:"getCurrentRoute",value:function(){return this.currentRouteSubject.value}},{key:"setCurrentRoute",value:function(e){this.currentRouteSubject.next(e)}},{key:"subScribeCurrentRoute",value:function(e){return this.currentRouteSubject.subscribe(e)}},{key:"setScribeCurrentCheckPoint",value:function(e){this.currentCheckPointSubject.next(e)}},{key:"subScribeCurrentCheckPoint",value:function(e){return this.currentCheckPointSubject.subscribe(e)}}])&&Pt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function jt(e){return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jt(e)}function Rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==jt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==jt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===jt(o)?o:String(o)),r)}var o}var kt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteLoop=t.currentRouteLoop}var t,n;return t=e,(n=[{key:"getCurrentRouteMix",value:function(){return{currentRouteLoop:this.currentRouteLoop}}},{key:"setCurrentRouteMix",value:function(e){e.currentRouteLoop&&(this.currentRouteLoop=e.currentRouteLoop)}}])&&Rt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Nt(e){return Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nt(e)}function At(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Nt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Nt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===Nt(o)?o:String(o)),r)}var o}function It(e,t,n){return t&&At(e.prototype,t),n&&At(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Ft=It((function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteManager=new xt(t),this.currentRouteMix=new kt(n)})),Tt=n(4564);function Mt(e){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mt(e)}function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(n),!0).forEach((function(t){var r,o,i;r=e,o=t,i=n[t],(o=function(e){var t=function(e,t){if("object"!==Mt(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Mt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Mt(t)?t:String(t)}(o))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Dt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return zt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _t(){var e,t,n,a,u,c,s=(0,S.Z)().classes,f=Dt((0,g.Mq)(),1)[0],m=(0,r.useRef)(-1),p=(0,R.R)(),d=Dt((0,r.useState)(l().generate),1)[0],y=Dt((0,r.useState)((function(){return new o.G(d)})),1)[0],v=(0,r.useRef)([0,0]),b=Dt((0,O.Rr)(O.SA.CurrentSwitchView,"Default"),2),C=b[0],N=b[1],A=(0,k.Z)(),I=A.mainApi,F=A.streamApi,T=A.isMainConnected,M=p.logger,L=p.panelId,V=p.subscribeToData,K=p.updateChannel,U=p.setKeyDownHandlers,W=p.removeKeyDownHandlers,B=(0,E.$G)("panels").t,G=Dt((0,Tt.R)(),2),H=(G[0],G[1],Dt((0,r.useState)(j().Perception.pointCloud.currentVisible),2)),Z=H[0],$=H[1],Y=Dt((0,r.useState)(null),2),J=Y[0],q=Y[1],X=Dt((0,r.useState)(null!==(e=null===(t=j().Planning.planningBoundaryLine)||void 0===t?void 0:t.currentVisible)&&void 0!==e&&e),2),Q=X[0],ee=X[1],te=Dt((0,r.useState)(null!==(n=null===(a=j().Planning.planningReferenceLine)||void 0===a?void 0:a.currentVisible)&&void 0!==n&&n),2),ne=te[0],re=te[1],oe=Dt((0,r.useState)(null!==(u=null===(c=j().Planning.planningTrajectoryLine)||void 0===c?void 0:c.currentVisible)&&void 0!==u&&u),2),ie=oe[0],ae=oe[1],le=(0,r.useMemo)((function(){return f.currentOperation===g.yc.WAYPOINT_FOLLOW?Ne.FOLLOW:Ne.DEFAULT}),[f.currentOperation]),ue=Dt((0,r.useState)(le),2),ce=ue[0],se=ue[1],fe=(0,r.useRef)(),me=(0,r.useRef)(null),pe=(0,r.useRef)(null),de=function e(){y.render(),fe.current=requestAnimationFrame(e)},ye=function(){null==y||y.updateData({object:[],autoDrivingCar:{}}),null==y||y.render(),null!=pe&&pe.current&&pe.current.unsubscribe(),me.current&&me.current.subscription&&(me.current.subscription.unsubscribe(),me.current=null)};(0,r.useEffect)((function(){se(le)}),[le]),(0,r.useEffect)((function(){y.init();var e=j();x.set(e),y.option.updateLayerOption(P(e),"vehicle"),e.Perception.pointCloud.currentVisible&&setTimeout((function(){K({name:h.DU.POINT_CLOUD,needChannel:!1})}),0)}),[]),(0,r.useEffect)((function(){var e=[{keys:["="],functionalKey:"ctrlKey",handler:function(e){var t;e.preventDefault(),null===(t=y.view)||void 0===t||t.updateViewDistance(-10)},discriptor:B("zoomIn")},{keys:["="],functionalKey:"metaKey",handler:function(e){var t;e.preventDefault(),null===(t=y.view)||void 0===t||t.updateViewDistance(-10)},discriptor:B("zoomIn")},{keys:["-"],functionalKey:"ctrlKey",handler:function(e){var t;e.preventDefault(),null===(t=y.view)||void 0===t||t.updateViewDistance(10)},discriptor:B("zoomOut")},{keys:["-"],functionalKey:"metaKey",handler:function(e){var t;e.preventDefault(),null===(t=y.view)||void 0===t||t.updateViewDistance(10)},discriptor:B("zoomOut")}];return U(e),function(){W(e)}}),[B]);var ve=function(e){var t,n,r,o=Vt({},e),i=null,a=(null==o||null===(t=o.planningData)||void 0===t?void 0:t.path)||[];return Array.isArray(null==o||null===(n=o.planningData)||void 0===n?void 0:n.path)?(Q||(i=["planning_path_boundary_1_regular/self","candidate_path_regular/self","planning_path_boundary_2_regular/self","planning_path_boundary_1_fallback/self","candidate_path_fallback/self","planning_path_boundary_2_fallback/self"],o.planningData.path=a.filter((function(e){return!i.includes(e.name)}))),a=(null==o||null===(r=o.planningData)||void 0===r?void 0:r.path)||[],ne||(i=["planning_reference_line"],o.planningData.path=a.filter((function(e){return!i.includes(e.name)}))),!ie&&o.planningTrajectory&&(o.planningTrajectory=[]),o):o};(0,r.useEffect)((function(){if(T){var e=null,t=null;if(ce===Ne.FOLLOW){y.removeAll(),y.view.setViewType("Overhead");var n=V({name:h.DU.SIM_WORLD,needChannel:!1});n&&(t=n.subscribe((function(e){if(e&&0!==Object.keys(e).length){var t={autoDrivingCar:e.autoDrivingCar,followPlanningData:e.planningTrajectory};y.updateData(t)}})))}if(ce===Ne.DEFAULT){y.follow.dispose();var r=(0,w.throttle)((function(e){I.getRoutePath().then((function(t){if(m.current=e.routingTime,0!==Object.keys(e).length){var n=Vt({},e);n.routePath=t.routePath,y.updateData(ve(n)),null==y||y.pointCloud.updateOffsetPosition()}}))}),500,{leading:!0}),o=V({name:h.DU.SIM_WORLD,needChannel:!1});o&&(t=o.subscribe((function(e){if(e){var t=e.autoDrivingCar;if(t){var n,o,i=null!==(n=t.positionX)&&void 0!==n?n:0,a=null!==(o=t.positionY)&&void 0!==o?o:0,l=Math.abs(v.current[0]-i)+Math.abs(v.current[1]-a);M.debug("车辆偏移距离：".concat(l,", 阈值为100")),l>100&&0!==v.current[0]&&0!==v.current[1]&&y&&y.initialized&&(M.debug("车辆偏移距离超过阈值，重置场景"),y.resetScence()),v.current=[i,a]}0!==Object.keys(e).length&&(e.routingTime&&e.routingTime!==m.current?r(e):(y.updateData(ve(e)),null==y||y.pointCloud.updateOffsetPosition()))}})));var i=V({name:h.DU.Map,needChannel:!1});i&&(e=i.subscribe((function(e){e&&(null==y||y.updateMap(e))})))}return de(),function(){ce===Ne.FOLLOW&&(y.view.setViewType("Default"),t&&t.unsubscribe()),ce===Ne.DEFAULT&&(e&&e.unsubscribe(),t&&t.unsubscribe());var n=fe.current;n&&cancelAnimationFrame(n)}}}),[ce,T,ne,Q,ie]);var be=(0,k.Z)().metadata,ge=(0,r.useMemo)((function(){return be.find((function(e){return e.dataName===h.DU.POINT_CLOUD}))}),[be,T]),he=(0,r.useMemo)((function(){return ge?ge.channels.map((function(e){return{label:null==e?void 0:e.channelName,value:null==e?void 0:e.channelName}})):[]}),[ge]),Ee=(0,r.useMemo)((function(){var e,t=null===(e=be.find((function(e){return e.dataName===h.DU.POINT_CLOUD})))||void 0===e||null===(e=e.channels)||void 0===e?void 0:e.filter((function(e){return(null==e?void 0:e.channelName.includes("compensator"))||(null==e?void 0:e.channelName.includes("fusion"))})).sort((function(e){return null!=e&&e.channelName.includes("compensator")?-1:1}));return Array.isArray(t)?t[0]:""}),[be]),we=(0,O._)("".concat(L,"-viz-pointcloud-channel"));(0,r.useEffect)((function(){var e=null;if(T){var t=we.get();Z&&t&&(e=V({name:h.DU.POINT_CLOUD,channel:t,needChannel:!0}))&&(pe.current=e.subscribe((function(e){e&&(null==y||y.updatePointCloud(e))})),q(t))}return function(){pe.current&&pe.current.unsubscribe(),y.pointCloud.disposeLastFrame()}}),[be,Z,T]),(0,r.useEffect)((function(){return function(){var e;null===(e=me.current)||void 0===e||null===(e=e.subscription)||void 0===e||e.unsubscribe()}}),[]);var Oe=r.createElement(D,{carviz:y,pointCloudFusionChannel:Ee,handlePointCloudVisible:$,curChannel:J,setCurChannel:q,pointcloudChannels:he,updatePointcloudChannel:function(e){ye();var t=F.subscribeToDataWithChannel(h.DU.POINT_CLOUD,e).subscribe((function(e){e&&(null==y||y.updatePointCloud(e))}));me.current={name:h.DU.POINT_CLOUD,subscription:t}},closeChannel:ye,handleReferenceLineVisible:re,handleBoundaryLineVisible:ee,handleTrajectoryLineVisible:ae});return r.createElement("div",{className:s["viz-container"]},r.createElement("div",{id:d,className:s["web-gl"]}),r.createElement("div",{className:s["viz-btn-container"]},r.createElement(_.Z,{from:"VehicleViz",carviz:y},r.createElement(i.J2,{placement:"leftTop",content:Oe,trigger:"click"},r.createElement("span",{className:s["viz-btn-item"]},r.createElement(i.Le,null))),r.createElement(i.J2,{overlayClassName:s["layer-menu-popover"],placement:"leftBottom",content:r.createElement(z.Z,{carviz:y,setCurrentView:N}),trigger:"click",style:{padding:"0 !importent"}},r.createElement("span",{className:s["viz-btn-item"]},null==C?void 0:C.charAt(0))))),r.createElement(xe,null))}function Kt(){var e=Dt(ve(),2)[1],t={routeOrigin:ue.EDITING_ROUTE,routePoint:{routeInitialPoint:null,routeWayPoint:[]}},n={currentRouteLoop:{currentRouteLoopState:!1}};return(0,r.useEffect)((function(){e(pt({routeManager:new Ft(t,n)}))}),[]),r.createElement(d,{initialPath:"/"},r.createElement(b,{path:"/",style:{minWidth:"244px",height:"100%",position:"relative"}},r.createElement(_t,null)),r.createElement(y,{path:"/routing",style:{width:"100%",height:"100%"}},r.createElement(wt,null)))}function Ut(){return r.createElement(ye,null,r.createElement(Kt,null))}function Wt(e){var t=(0,r.useMemo)((function(){return(0,K.Z)({PanelComponent:Ut,panelId:e.panelId})}),[]);return r.createElement(t,e)}Ut.displayName="VehicleViz";const Bt=r.memo(Wt)}}]);