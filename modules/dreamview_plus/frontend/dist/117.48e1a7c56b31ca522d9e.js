"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[117],{12500:(e,n,t)=>{t.r(n),t.d(n,{default:()=>L});var i=t(21902),r=t(87602),l=t(22770),a=t(54067),o=t(97265),u=t.n(o),c=t(80151),s=t(58938),b=t(16125),f=t(56733),y=t(79424),d=t(51999),p=t(52007),v=t(4492),m=t(36469),V={Perception:{polygon:{defaultVisible:!0,currentVisible:!0,vizKey:"polygon"},boundingbox:{defaultVisible:!1,currentVisible:!1,vizKey:"boundingbox"},pointCloud:{defaultVisible:!0,currentVisible:!0,vizKey:"pointCloud"},unknownMovable:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownMovable"},vehicle:{defaultVisible:!0,currentVisible:!0,vizKey:"vehicle"},unknownStationary:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownUnmovable"},pedestrian:{defaultVisible:!0,currentVisible:!0,vizKey:"pedestrian"},unknown:{defaultVisible:!0,currentVisible:!0,vizKey:"unknown"},bicycle:{defaultVisible:!0,currentVisible:!0,vizKey:"bicycle"},cipv:{defaultVisible:!0,currentVisible:!0,vizKey:"cipv"},velocity:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleVelocity"},heading:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleHeading"},id:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleId"},distanceAndSpeed:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDistanceAndSpeed"},laneMarker:{defaultVisible:!0,currentVisible:!0,vizKey:"laneMarker"},lidarSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"lidarSensor"},radarSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"radarSensor"},cameraSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"cameraSensor"},v2x:{defaultVisible:!0,currentVisible:!0,vizKey:"v2x"}},Prediction:{priority:{defaultVisible:!1,currentVisible:!1,vizKey:"obstaclePriority"},majorPredictionLine:{defaultVisible:!1,currentVisible:!1,vizKey:"majorPredictionLine"},gaussianInfo:{defaultVisible:!1,currentVisible:!1,vizKey:"gaussianInfo"},minorPredictionLine:{defaultVisible:!1,currentVisible:!1,vizKey:"minorPredictionLine"},interactiveTag:{defaultVisible:!1,currentVisible:!1,vizKey:"obstacleInteractiveTag"}},Routing:{routingLine:{defaultVisible:!1,currentVisible:!1,vizKey:"routingLine"}},Decision:{mainDecision:{defaultVisible:!1,currentVisible:!1,vizKey:"mainDecision"},obstacleDecision:{defaultVisible:!1,currentVisible:!1,vizKey:"obstacleDecision"}},Planning:{planningCar:{defaultVisible:!1,currentVisible:!1,vizKey:"planningCar"},planningTrajectory:{defaultVisible:!1,currentVisible:!1,vizKey:"planningTrajectory"}},Position:{localization:{defaultVisible:!0,currentVisible:!0,vizKey:"localization"},gps:{defaultVisible:!1,currentVisible:!1,vizKey:"gps"},shadow:{defaultVisible:!1,currentVisible:!1,vizKey:"shadow"}},Map:{crosswalk:{defaultVisible:!1,currentVisible:!1,vizKey:"crosswalk"},clearArea:{defaultVisible:!1,currentVisible:!1,vizKey:"clearArea"},junction:{defaultVisible:!1,currentVisible:!1,vizKey:"junction"},pncJunction:{defaultVisible:!1,currentVisible:!1,vizKey:"pncJunction"},lane:{defaultVisible:!1,currentVisible:!1,vizKey:"lane"},road:{defaultVisible:!1,currentVisible:!1,vizKey:"road"},signal:{defaultVisible:!1,currentVisible:!1,vizKey:"signal"},stopSign:{defaultVisible:!1,currentVisible:!1,vizKey:"stopSign"},yieldSign:{defaultVisible:!1,currentVisible:!1,vizKey:"yieldSign"},speedBump:{defaultVisible:!1,currentVisible:!1,vizKey:"speedBump"},parkingSpace:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpace"},parkingSpaceId:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpaceId"},laneId:{defaultVisible:!1,currentVisible:!1,vizKey:"laneId"}}},g=function(e){var n={};return Object.keys(e).forEach((function(t){var i=e[t];Object.keys(i).forEach((function(e){var r=i[e];n[t]=n[t]||{},n[t][r.vizKey]=r.currentVisible}))})),n},h=new m.mM(m.SA.PointCloudLayerMenu),z=function(){return h.get()||V},S=t(27140);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function w(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function E(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?w(Object(t),!0).forEach((function(n){O(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function O(e,n,t){return(n=function(e){var n=function(e,n){if("object"!==K(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!==K(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===K(n)?n:String(n)}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function C(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,l,a,o=[],u=!0,c=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(i=l.call(t)).done)&&(o.push(i.value),o.length!==n);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}(e,n)||function(e,n){if(e){if("string"==typeof e)return P(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?P(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function j(e){var n=(0,f.Z)().classes,t=e.carviz,r=e.obstacleChannels,o=e.updateObstacleChannel,u=e.closeChannel,c=e.showPerception,s=e.setShowPerception,b=e.curChannel,y=e.setCurChannel,d=(0,a.$G)("layerMenu").t,p=z();h.set(p),t.option.updateLayerOption(g(p),"pointCloud");var v=C((0,i.useState)(p),2),m=v[0],V=v[1],K=C((0,i.useState)(Object.keys(m)),1)[0],w=C((0,i.useState)(K[0]),1)[0],P=C((0,i.useState)(m[w]),2)[1];return i.createElement("div",{className:n["layer-menu-container"]},i.createElement("div",{className:n["layer-menu-content"]},i.createElement("div",{className:n["layer-menu-content-left"]},i.createElement("span",{className:n["layer-menu-content-right-switch"],style:{display:"inline-block",marginTop:"6px"}},i.createElement(l.XZ,{checked:c,defaultChecked:!0,onChange:function(e){e.target.checked&&r.length?(s(!0),o(b)):(s(!1),u())}})),d("perception")),i.createElement("div",{className:n["layer-menu-content-right"]},i.createElement(S.Z,{value:b,options:r,onChange:function(e){return function(e){y(e),o(e)}(e)}}),i.createElement("div",{className:n["layer-menu-horizontal-line"]}),i.createElement("li",{className:n["layer-menu-content-right-li"]},i.createElement("span",{className:n["layer-menu-content-right-switch"]},i.createElement(l.Y8,{checked:m.Perception.polygon.currentVisible,onChange:function(e){if(e.target.checked){var n=E(E({},m.Perception),{},{polygon:E(E({},m.Perception.polygon),{},{currentVisible:!0}),boundingbox:E(E({},m.Perception.boundingbox),{},{currentVisible:!1})}),i=E(E({},m),{},O({},w,n));P((function(){return n})),V((function(){return i})),t.option.updateLayerOption(g(i),"vehicle"),h.set(i)}}})),i.createElement("span",{className:n["layer-menu-content-right-label"]},d("polygon"))),i.createElement("li",{className:n["layer-menu-content-right-li"]},i.createElement("span",{className:n["layer-menu-content-right-switch"]},i.createElement(l.Y8,{checked:m.Perception.boundingbox.currentVisible,onChange:function(e){if(e.target.checked){var n=E(E({},m.Perception),{},{polygon:E(E({},m.Perception.polygon),{},{currentVisible:!1}),boundingbox:E(E({},m.Perception.boundingbox),{},{currentVisible:!0})}),i=E(E({},m),{},O({},w,n));P((function(){return n})),V((function(){return i})),t.option.updateLayerOption(g(i),"vehicle"),h.set(i)}}})),i.createElement("span",{className:n["layer-menu-content-right-label"]},d("boundingbox"))))))}function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function D(e,n,t){return(n=function(e){var n=function(e,n){if("object"!==k(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!==k(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===k(n)?n:String(n)}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function I(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,l,a,o=[],u=!0,c=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(i=l.call(t)).done)&&(o.push(i.value),o.length!==n);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}(e,n)||function(e,n){if(e){if("string"==typeof e)return N(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?N(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function A(){var e=I((0,i.useState)(!0),2),n=e[0],t=e[1],o=I((0,i.useState)(null),2),v=o[0],m=o[1],V=(0,p.R)(),S=I((0,i.useState)(u().generate),1)[0],K=I((0,c.Mq)(),1)[0],w=V.initSubscription,E=V.setKeyDownHandlers,O=V.removeKeyDownHandlers,C=(0,f.Z)().classes,P=I((0,i.useState)("D"),2),k=P[0],N=P[1],A=I((0,i.useState)((function(){return new r.G(S)})),1)[0],M=(0,a.$G)("panels").t,L=I((0,i.useState)(null),2),T=L[0],x=L[1],U=(0,b.Z)(),Z=U.metadata,R=U.isMainConnected,J=U.streamApi,$=(0,i.useRef)(null),_=(0,i.useMemo)((function(){return Z.find((function(e){return"obstacle"===e.dataName}))}),[Z,R]),G=(0,i.useMemo)((function(){return _?_.channels.map((function(e){return{label:null==e?void 0:e.channelName,value:null==e?void 0:e.channelName}})):[]}),[_]),H=function(){null==A||A.updateData({object:[],autoDrivingCar:{}}),$.current&&$.current.subscription&&($.current.subscription.unsubscribe(),$.current=null)},W=function(e){H();var n=J.subscribeToDataWithChannel("obstacle",e).subscribe((function(e){var n={CopyAutoDrivingCar:e.autoDrivingCar,object:e.obstacle||[]};null==A||A.updateData(n)}));$.current={name:"obstacle",subscription:n}};(0,i.useEffect)((function(){A.init();var e=z();h.set(e),A.option.updateLayerOption(g(e),"pointCloud")}),[]),(0,i.useEffect)((function(){var e=[{keys:["="],functionalKey:"ctrlKey",handler:function(e){var n;e.preventDefault(),null===(n=A.view)||void 0===n||n.updateViewDistance(-10)},discriptor:M("zoomIn")},{keys:["="],functionalKey:"metaKey",handler:function(e){var n;e.preventDefault(),null===(n=A.view)||void 0===n||n.updateViewDistance(-10)},discriptor:M("zoomIn")},{keys:["-"],functionalKey:"ctrlKey",handler:function(e){var n;e.preventDefault(),null===(n=A.view)||void 0===n||n.updateViewDistance(10)},discriptor:M("zoomOut")},{keys:["-"],functionalKey:"metaKey",handler:function(e){var n;e.preventDefault(),null===(n=A.view)||void 0===n||n.updateViewDistance(10)},discriptor:M("zoomOut")}];return E(e),function(){O(e)}}),[M]),(0,i.useEffect)((function(){if(G&&0!==G.length&&J){var e=G[0];m(e.value),n&&W(e.value)}}),[G,J]),(0,i.useEffect)((function(){return function(){var e;null===(e=$.current)||void 0===e||null===(e=e.subscription)||void 0===e||e.unsubscribe()}}),[]),(0,i.useEffect)((function(){var e;w((D(e={},s.DU.SIM_WORLD,{consumer:function(e){A.updateData(e)}}),D(e,s.DU.POINT_CLOUD,{consumer:function(e){x(e)}}),e))}),[]),(0,i.useEffect)((function(){T&&(null==A||A.updatePointCloud(T))}),[T]);var q=(0,i.useRef)(0),B=function e(){null==A||A.render(),q.current=requestAnimationFrame(e)};(0,i.useEffect)((function(){return B(),function(){var e=q.current;e&&cancelAnimationFrame(e)}}),[]),(0,i.useEffect)((function(){x(null),null==A||A.removeAll()}),[K.currentRecordId]);var F=i.createElement(j,{curChannel:v,setCurChannel:m,carviz:A,obstacleChannels:G,updateObstacleChannel:W,closeChannel:H,showPerception:n,setShowPerception:t});return i.createElement("div",{className:C["viz-container"]},i.createElement("div",{id:S,className:C["web-gl"]}),i.createElement("div",{className:C["viz-btn-container"]},i.createElement(d.Z,{from:"PointCloud",carviz:A},i.createElement(l.J2,{placement:"leftTop",trigger:"click",content:F},i.createElement("span",{className:C["viz-btn-item"]},i.createElement(l.Le,null))),i.createElement(l.J2,{placement:"leftTop",content:i.createElement(y.Z,{carviz:A,setCurrentView:N}),trigger:"click"},i.createElement("span",{className:C["viz-btn-item"]},k)))))}function M(e){var n=(0,i.useMemo)((function(){return(0,v.Z)({PanelComponent:A,panelId:e.panelId,subscribeInfo:[{name:s.DU.POINT_CLOUD,needChannel:!0},{name:s.DU.SIM_WORLD,needChannel:!1}]})}),[]);return i.createElement(n,e)}A.displayName="PointCloud";const L=i.memo(M)}}]);