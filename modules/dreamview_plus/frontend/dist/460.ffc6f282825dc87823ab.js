"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[460],{73994:(e,n,t)=>{t.r(n),t.d(n,{default:()=>M});var i=t(40366),r=t.n(i),l=t(85322),a=t(47960),o=t(36242),u=t(46533),c=t(84436),s=t(26064),b=t(38129),f=t(96676),d=t(2975),y=t(83517),v=t(60346),p=t(11446),m={Perception:{polygon:{defaultVisible:!0,currentVisible:!0,vizKey:"polygon"},boundingbox:{defaultVisible:!1,currentVisible:!1,vizKey:"boundingbox"},pointCloud:{defaultVisible:!0,currentVisible:!0,vizKey:"pointCloud"},unknownMovable:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownMovable"},vehicle:{defaultVisible:!0,currentVisible:!0,vizKey:"vehicle"},unknownStationary:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownUnmovable"},pedestrian:{defaultVisible:!0,currentVisible:!0,vizKey:"pedestrian"},unknown:{defaultVisible:!0,currentVisible:!0,vizKey:"unknown"},bicycle:{defaultVisible:!0,currentVisible:!0,vizKey:"bicycle"},cipv:{defaultVisible:!0,currentVisible:!0,vizKey:"cipv"},velocity:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleVelocity"},heading:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleHeading"},id:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleId"},distanceAndSpeed:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDistanceAndSpeed"},laneMarker:{defaultVisible:!0,currentVisible:!0,vizKey:"laneMarker"},lidarSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"lidarSensor"},radarSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"radarSensor"},cameraSensor:{defaultVisible:!0,currentVisible:!0,vizKey:"cameraSensor"},v2x:{defaultVisible:!0,currentVisible:!0,vizKey:"v2x"}},Prediction:{priority:{defaultVisible:!1,currentVisible:!1,vizKey:"obstaclePriority"},majorPredictionLine:{defaultVisible:!1,currentVisible:!1,vizKey:"majorPredictionLine"},gaussianInfo:{defaultVisible:!1,currentVisible:!1,vizKey:"gaussianInfo"},minorPredictionLine:{defaultVisible:!1,currentVisible:!1,vizKey:"minorPredictionLine"},interactiveTag:{defaultVisible:!1,currentVisible:!1,vizKey:"obstacleInteractiveTag"}},Routing:{routingLine:{defaultVisible:!1,currentVisible:!1,vizKey:"routingLine"}},Decision:{mainDecision:{defaultVisible:!1,currentVisible:!1,vizKey:"mainDecision"},obstacleDecision:{defaultVisible:!1,currentVisible:!1,vizKey:"obstacleDecision"}},Planning:{planningCar:{defaultVisible:!1,currentVisible:!1,vizKey:"planningCar"},planningTrajectory:{defaultVisible:!1,currentVisible:!1,vizKey:"planningTrajectory"}},Position:{localization:{defaultVisible:!0,currentVisible:!0,vizKey:"localization"},gps:{defaultVisible:!1,currentVisible:!1,vizKey:"gps"},shadow:{defaultVisible:!1,currentVisible:!1,vizKey:"shadow"}},Map:{crosswalk:{defaultVisible:!1,currentVisible:!1,vizKey:"crosswalk"},clearArea:{defaultVisible:!1,currentVisible:!1,vizKey:"clearArea"},junction:{defaultVisible:!1,currentVisible:!1,vizKey:"junction"},pncJunction:{defaultVisible:!1,currentVisible:!1,vizKey:"pncJunction"},lane:{defaultVisible:!1,currentVisible:!1,vizKey:"lane"},road:{defaultVisible:!1,currentVisible:!1,vizKey:"road"},signal:{defaultVisible:!1,currentVisible:!1,vizKey:"signal"},stopSign:{defaultVisible:!1,currentVisible:!1,vizKey:"stopSign"},yieldSign:{defaultVisible:!1,currentVisible:!1,vizKey:"yieldSign"},speedBump:{defaultVisible:!1,currentVisible:!1,vizKey:"speedBump"},parkingSpace:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpace"},barrierGate:{defaultVisible:!1,currentVisible:!1,vizKey:"barrierGate"},area:{defaultVisible:!1,currentVisible:!1,vizKey:"area"},parkingSpaceId:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpaceId"},laneId:{defaultVisible:!1,currentVisible:!1,vizKey:"laneId"}}},V=function(e){var n={};return Object.keys(e).forEach((function(t){var i=e[t];Object.keys(i).forEach((function(e){var r=i[e];n[t]=n[t]||{},n[t][r.vizKey]=r.currentVisible}))})),n},g=new p.DT(p.qK.PointCloudLayerMenu),h=function(){return g.get()||m},z=t(1434);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function S(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?S(Object(t),!0).forEach((function(n){E(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function E(e,n,t){return(n=function(e){var n=function(e){if("object"!=K(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,"string");if("object"!=K(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==K(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function C(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,l,a,o=[],u=!0,c=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(i=l.call(t)).done)&&(o.push(i.value),o.length!==n);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}(e,n)||function(e,n){if(e){if("string"==typeof e)return O(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?O(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=Array(n);t<n;t++)i[t]=e[t];return i}function P(e){var n=(0,b.A)().classes,t=e.carviz,o=e.obstacleChannels,u=e.updateObstacleChannel,c=e.closeChannel,s=e.showPerception,f=e.setShowPerception,d=e.curChannel,y=e.setCurChannel,v=(0,a.Bd)("layerMenu").t,p=(0,a.Bd)("panels").t,m=h();g.set(m),t.option.updateLayerOption(V(m),"pointCloud");var K=C((0,i.useState)(m),2),S=K[0],O=K[1],P=C((0,i.useState)(Object.keys(S)),1)[0],j=C((0,i.useState)(P[0]),1)[0],k=C((0,i.useState)(S[j]),2)[1];return r().createElement("div",{className:n["layer-menu-container"]},r().createElement("div",{className:n["layer-menu-header"]},r().createElement("div",{className:n["layer-menu-header-left"]},p("layerMenu"))),r().createElement("div",{className:n["layer-menu-content"]},r().createElement("div",{className:n["layer-menu-content-left"]},r().createElement("span",{className:n["layer-menu-content-right-switch"],style:{display:"inline-block",marginTop:"6px"}},r().createElement(l.Sc,{checked:s,defaultChecked:!0,onChange:function(e){e.target.checked&&o.length?(f(!0),u(d)):(f(!1),c())}})),v("perception")),r().createElement("div",{className:n["layer-menu-content-right"]},r().createElement(z.A,{value:d,options:o,onChange:function(e){return function(e){y(e),u(e)}(e)}}),r().createElement("div",{className:n["layer-menu-horizontal-line"]}),r().createElement("li",{className:n["layer-menu-content-right-li"]},r().createElement("span",{className:n["layer-menu-content-right-switch"]},r().createElement(l.sx,{checked:S.Perception.polygon.currentVisible,onChange:function(e){if(e.target.checked){var n=w(w({},S.Perception),{},{polygon:w(w({},S.Perception.polygon),{},{currentVisible:!0}),boundingbox:w(w({},S.Perception.boundingbox),{},{currentVisible:!1})}),i=w(w({},S),{},E({},j,n));k((function(){return n})),O((function(){return i})),t.option.updateLayerOption(V(i),"vehicle"),g.set(i)}}})),r().createElement("span",{className:n["layer-menu-content-right-label"]},v("polygon"))),r().createElement("li",{className:n["layer-menu-content-right-li"]},r().createElement("span",{className:n["layer-menu-content-right-switch"]},r().createElement(l.sx,{checked:S.Perception.boundingbox.currentVisible,onChange:function(e){if(e.target.checked){var n=w(w({},S.Perception),{},{polygon:w(w({},S.Perception.polygon),{},{currentVisible:!1}),boundingbox:w(w({},S.Perception.boundingbox),{},{currentVisible:!0})}),i=w(w({},S),{},E({},j,n));k((function(){return n})),O((function(){return i})),t.option.updateLayerOption(V(i),"vehicle"),g.set(i)}}})),r().createElement("span",{className:n["layer-menu-content-right-label"]},v("boundingbox"))))))}function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function k(e,n,t){return(n=function(e){var n=function(e){if("object"!=j(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,"string");if("object"!=j(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==j(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function A(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,r,l,a,o=[],u=!0,c=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;u=!1}else for(;!(u=(i=l.call(t)).done)&&(o.push(i.value),o.length!==n);u=!0);}catch(e){c=!0,r=e}finally{try{if(!u&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}(e,n)||function(e,n){if(e){if("string"==typeof e)return D(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?D(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=Array(n);t<n;t++)i[t]=e[t];return i}function I(){var e=A((0,i.useState)(!0),2),n=e[0],t=e[1],v=A((0,i.useState)(null),2),p=v[0],m=v[1],z=(0,y.d)(),K=A((0,o.qZ)(),1)[0],S=z.initSubscription,w=z.setKeyDownHandlers,E=z.removeKeyDownHandlers,C=(0,b.A)().classes,O=A((0,i.useState)("D"),2),j=O[0],D=O[1],I=A((0,s.A)(),2),N=I[0],M=I[1],x=(0,a.Bd)("panels").t,L=A((0,i.useState)(null),2),T=L[0],R=L[1],B=(0,c.A)(),U=B.metadata,H=B.isMainConnected,_=B.streamApi,q=(0,i.useRef)(null),W=(0,i.useMemo)((function(){return U.find((function(e){return"obstacle"===e.dataName}))}),[U,H]),F=(0,i.useMemo)((function(){return W?W.channels.map((function(e){return{label:null==e?void 0:e.channelName,value:null==e?void 0:e.channelName}})):[]}),[W]),G=function(){null==N||N.updateData({object:[],autoDrivingCar:{}}),q.current&&q.current.subscription&&(q.current.subscription.unsubscribe(),q.current=null)},J=function(e){G();var n=_.subscribeToDataWithChannel("obstacle",e).subscribe((function(e){var n={CopyAutoDrivingCar:e.autoDrivingCar,object:e.obstacle||[]};null==N||N.updateData(n)}));q.current={name:"obstacle",subscription:n}};(0,i.useEffect)((function(){N.init();var e=h();g.set(e),N.option.updateLayerOption(V(e),"pointCloud")}),[]),(0,i.useEffect)((function(){var e=[{keys:["="],functionalKey:"ctrlKey",handler:function(e){var n;e.preventDefault(),null===(n=N.view)||void 0===n||n.updateViewDistance(-10)},discriptor:x("zoomIn")},{keys:["="],functionalKey:"metaKey",handler:function(e){var n;e.preventDefault(),null===(n=N.view)||void 0===n||n.updateViewDistance(-10)},discriptor:x("zoomIn")},{keys:["-"],functionalKey:"ctrlKey",handler:function(e){var n;e.preventDefault(),null===(n=N.view)||void 0===n||n.updateViewDistance(10)},discriptor:x("zoomOut")},{keys:["-"],functionalKey:"metaKey",handler:function(e){var n;e.preventDefault(),null===(n=N.view)||void 0===n||n.updateViewDistance(10)},discriptor:x("zoomOut")}];return w(e),function(){E(e)}}),[x]),(0,i.useEffect)((function(){if(F&&0!==F.length&&_){var e=F[0];m(e.value),n&&J(e.value)}}),[F,_]),(0,i.useEffect)((function(){return function(){var e;null===(e=q.current)||void 0===e||null===(e=e.subscription)||void 0===e||e.unsubscribe()}}),[]),(0,i.useEffect)((function(){S(k(k({},u.lt.SIM_WORLD,{consumer:function(e){N.adc.updateOffset(e.autoDrivingCar,"adc")}}),u.lt.POINT_CLOUD,{consumer:function(e){R(e)}}))}),[]),(0,i.useEffect)((function(){T&&(null==N||N.updatePointCloud(T))}),[T]);var $=(0,i.useRef)(0),Z=function(){null==N||N.render(),$.current=requestAnimationFrame(Z)};(0,i.useEffect)((function(){return Z(),function(){var e=$.current;e&&cancelAnimationFrame(e)}}),[]),(0,i.useEffect)((function(){R(null),null==N||N.removeAll()}),[K.currentRecordId]);var Q=r().createElement(P,{curChannel:p,setCurChannel:m,carviz:N,obstacleChannels:F,updateObstacleChannel:J,closeChannel:G,showPerception:n,setShowPerception:t});return r().createElement("div",{className:C["viz-container"]},r().createElement("div",{id:M,className:C["web-gl"]}),r().createElement("div",{className:C["viz-btn-container"]},r().createElement(d.A,{from:"PointCloud",carviz:N},r().createElement(l.AM,{placement:"leftTop",trigger:"click",content:Q},r().createElement("span",{className:C["viz-btn-item"]},r().createElement(l.Av,{name:"IcCoverageHover"}))),r().createElement(l.AM,{placement:"leftTop",content:r().createElement(f.A,{carviz:N,setCurrentView:D}),trigger:"click"},r().createElement("span",{className:C["viz-btn-item"]},null==j?void 0:j.charAt(0))))))}function N(e){var n=(0,i.useMemo)((function(){return(0,v.A)({PanelComponent:I,panelId:e.panelId,subscribeInfo:[{name:u.lt.POINT_CLOUD,needChannel:!0},{name:u.lt.SIM_WORLD,needChannel:!1}]})}),[]);return r().createElement(n,e)}I.displayName="PointCloud";const M=r().memo(N)}}]);