"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[907],{70907:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var r=n(40366),a=n.n(r),i=n(85322),o=n(15076),c=n(11446);const l=(0,n(12391).makeStyles)((function(){return{"panel-camera-root":{position:"relative",height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},"camera-btn-container":{position:"absolute",bottom:"24px",right:"24px"},"camera-btn-item":{display:"inline-block",cursor:"pointer",textAlign:"center",width:"32px",height:"32px",lineHeight:"32px",background:"#343C4D",borderRadius:"6px",marginTop:"12px",fontSize:"16px"},"camera-canvas-container":{width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",display:"flex",justifyContent:"center",alignItems:"center"},"panel-camera-canvas":{},"layer-menu-container":{width:"158px",height:"94px"},"layer-menu-header":{height:"40px",paddingLeft:"24px",display:"flex",alignItems:"center",borderBottom:"1px solid #383B45",fontFamily:"PingFangSC-Medium",fontSize:"16px",color:"#FFFFFF",fontWeight:"500"},"layer-menu-content-right":{height:"54px",paddingLeft:"24px",display:"flex",alignItems:"center",fontFamily:"PingFangSC-Regular",fontSize:"14px",color:"#A6B5CC",fontWeight:"400"}}}));var u=n(83517),s=new Map([["ST_UNKNOWN","rgba(96, 96, 96, 1.000)"],["ST_UNKNOWN_MOVABLE","rgba(96, 96, 96, 1.000)"],["ST_UNKNOWN_UNMOVABLE","rgba(96, 96, 96, 1.000)"],["ST_CAR","rgba(243, 187, 37, 1.000)"],["ST_VAN","rgba(243, 187, 37, 1.000)"],["ST_TRUCK","rgba(243, 187, 37, 1.000)"],["ST_BUS","rgba(243, 187, 37, 1.000)"],["ST_CYCLIST","rgba(231, 91, 135, 1.000)"],["ST_MOTORCYCLIST","rgba(231, 91, 135, 1.000)"],["ST_TRICYCLIST","rgba(231, 91, 135, 1.000)"],["ST_PEDESTRIAN","#35DACF"],["ST_TRAFFICCONE","#35DACF"]]),f=n(47960),m={"":{boundingbox:{defaultVisible:!1,currentVisible:!1,vizKey:"Boundingbox"}}};function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return(t=function(e){var t=function(e){if("object"!=y(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==y(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,c=[],l=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function v(e){var t=(0,u.d)().panelId,n=e.setShowBoundingBox,o=l(),s=o.classes,y=o.cx,b=(0,f.Bd)("layerMenu").t,h=d((0,r.useState)(m),2),v=h[0],S=h[1],w=d((0,r.useState)((function(){return Object.keys(v)})),1)[0],x=d((0,r.useState)(w[0]),2),E=x[0],O=x[1],j=d((0,r.useState)(v[E]),2),C=j[0],I=j[1],A=(0,c.Mj)("".concat(c.qK.layerMenu).concat(t)),T=(0,c.Mj)("".concat(c.qK.BBox).concat(t));return(0,r.useEffect)((function(){var e=A.get();e&&(S(e),O(w[0]),I(e[w[0]]))}),[]),a().createElement("div",{className:s["layer-menu-container"]},a().createElement("div",{className:s["layer-menu-header"]},a().createElement("div",{className:s["layer-menu-header-left"]},b("layerMenu")),a().createElement("div",{className:s["layer-menu-header-right"]})),a().createElement("div",{className:s["layer-menu-content"]},a().createElement("div",{className:s["layer-menu-content-left"]},w.map((function(e){return a().createElement("li",{key:e,className:y(s["layer-menu-content-left-li"],p({},s["li-active"],E===e)),onClick:function(){O(e),I(v[e])}},a().createElement("span",null,e))}))),a().createElement("div",{className:s["layer-menu-content-right"]},Object.keys(C).map((function(e){var t=v[E][e].currentVisible;return a().createElement("li",{key:e},a().createElement("span",null,a().createElement(i.Sc,{checked:t,defaultChecked:"1"===T.get(),onChange:function(t){var r=t.target.checked;n(r),T.set(r?1:0);var a=g(g({},v[E]),{},p({},e,g(g({},v[E][e]),{},{currentVisible:r}))),i=g(g({},v),{},p({},E,a));I((function(){return a})),S((function(){return i})),A.set(i)}},e)))})))))}const S=a().memo(v);var w=n(46533),x=n(60346),E=n(27878);function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,c=[],l=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function I(){var e=(0,u.d)(),t=e.logger,n=e.panelId,f=e.onPanelResize,m=e.initSubscription,y=(0,c.Mj)("".concat(c.qK.BBox).concat(n)),b=j((0,r.useState)((function(){return y.get()})),2),g=b[0],p=b[1],d=j((0,r.useState)(null),2),h=d[0],v=d[1],x=j((0,r.useState)(),2),C=x[0],I=x[1],A=(0,r.useRef)(null);(0,r.useEffect)((function(){var e,t,n;m((e={},t=w.lt.CAMERA,n={consumer:function(e){I(e)}},(t=function(e){var t=function(e){if("object"!=O(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==O(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e))}),[]),(0,r.useLayoutEffect)((function(){f((function(e,t){v({viewPortWidth:e,viewPortHeight:t})}))}),[]),(0,r.useEffect)((function(){var e;if(!(0,o.isEmpty)(C)&&(null==C||null===(e=C.image)||void 0===e?void 0:e.length)>0){var r=C.kImageScale,a=new Uint8Array(C.image),i=new Blob([a],{type:"image/jpeg"});createImageBitmap(i).then((function(e){var a=A.current;if(a){var i={},o=e.width/e.height>h.viewPortWidth/h.viewPortHeight,c=h.viewPortWidth/e.width,l=h.viewPortHeight/e.height,u=o?c:l;i.drawImageWidth=e.width*u,i.drawImageHeight=e.height*u,a.width=i.drawImageWidth,a.height=i.drawImageHeight;var f=a.getContext("2d");f.drawImage(e,0,0,i.drawImageWidth,i.drawImageHeight),C.bbox2d&&C.bbox2d.length>0&&g&&(t.debug(n,"has obstacles"),C.bbox2d.forEach((function(e,a){var i=C.obstaclesId[a],o=C.obstaclesSubType[a];f.strokeStyle=s.get(o)||"red";var c=e.xmin,l=e.ymin,m=e.xmax,y=e.ymax;if(c!==l||l!==m||m!==y){var b=j([c,l,m,y].map((function(e){return e*(null!=r?r:1)*u})),4);c=b[0],l=b[1],m=b[2],y=b[3],f.strokeRect(c,l,m-c,y-l),f.fillStyle=s.get(o)||"white",f.font="12px Arial",f.fillText("".concat(o.substring(3),":").concat(i),c,l)}else t.debug(n,"bbox is empty")})))}})).catch((function(e){t.error(e)}))}}),[C,g,h]);var T=l().classes;return a().createElement("div",{className:T["panel-camera-root"]},a().createElement("div",{className:T["camera-btn-container"]},a().createElement(i.AM,{placement:"leftTop",content:a().createElement(S,{setShowBoundingBox:p}),trigger:"click"},a().createElement("span",{className:T["camera-btn-item"]},a().createElement(i.Av,{name:"IcCoverageHover"})))),a().createElement(E.A,{className:T["camera-canvas-container"]},a().createElement("canvas",{ref:A,id:"camera-".concat(n),className:T["panel-camera-canvas"]})))}function A(e){var t=(0,r.useMemo)((function(){return(0,x.A)({PanelComponent:I,panelId:e.panelId,subscribeInfo:[{name:w.lt.CAMERA,needChannel:!0}]})}),[]);return a().createElement(t,e)}I.displayName="InternalCameraView";const T=a().memo(A)}}]);